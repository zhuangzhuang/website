<!DOCTYPE html><html><head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
        <meta name="description">
        <meta name="keywords" content="static content generator,static site generator,static site,HTML,web development,.NET,C#,Razor,Markdown,YAML">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="/assets/img/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/assets/img/favicon.ico" type="image/x-icon">
        <title>Cake - Visual Studio Team Services</title>
        <link href="/assets/css/mermaid.css" rel="stylesheet">
        <link href="/assets/css/highlight.css" rel="stylesheet">
        <link href="/assets/css/bootstrap/bootstrap.css" rel="stylesheet">
        <link href="/assets/css/adminlte/AdminLTE.css" rel="stylesheet">
        <link href="/assets/css/theme/theme.css" rel="stylesheet">
        <link href="//fonts.googleapis.com/css?family=Roboto+Mono:400,700|Roboto:400,400i,700,700i" rel="stylesheet">
        <link href="/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href="/assets/css/override.css" rel="stylesheet">
        <script src="/assets/js/jquery-2.2.3.min.js"></script>
        <script src="/assets/js/bootstrap.min.js"></script>        
        <script src="/assets/js/app.min.js"></script>         
        <script src="/assets/js/highlight.pack.js"></script>   
        <script src="/assets/js/jquery.slimscroll.min.js"></script>
        <script src="/assets/js/jquery.sticky-kit.min.js"></script>
        <script src="/assets/js/mermaid.min.js"></script>
        <!--[if lt IE 9]>
        <script src="/assets/js/html5shiv.min.js"></script>
        <script src="/assets/js/respond.min.js"></script>
        <![endif]-->  

        
    </head>
    <body class="hold-transition wyam layout-boxed  ">    
        <div class="top-banner"></div>
        <div class="wrapper with-container">
            <!-- Header -->
            <header class="main-header">   
                     
                <a href="/" class="logo">

                                <!-- mini logo for sidebar mini 50x50 pixels -->
                                <span class="logo-mini"><img src="/assets/img/logo.png"></span>
                                <!-- logo for regular state and mobile devices -->
                                <span class="logo-lg"><img src="/assets/img/logo.png"></span>
                                            </a>   
                         
                <nav class="navbar navbar-static-top" role="navigation">
                    <!-- Sidebar toggle button-->
                        <a href="#" class="sidebar-toggle visible-xs-block" data-toggle="offcanvas" role="button">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-right"></i>
                        </a>
                                        
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-down"></i>
                        </button>
                    </div>
            
                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
                        <ul class="nav navbar-nav">                            
                                    <li><a href="/blog">Blog</a></li>
        <li class="active"><a href="/docs">Documentation</a></li>
        <li><a href="/dsl">Reference</a></li>
        <li><a href="/addins">Addins</a></li>
        <li><a href="/api">API</a></li>
        <li><a href="https://github.com/cake-build/cake"><i class="fa fa-github"></i> Source</a></li>
 
                        </ul>       
                    </div>
                    <!-- /.navbar-collapse -->
                
                    <!-- Navbar Right Menu -->
                </nav>
            </header>
            
            <!-- Left side column. contains the logo and sidebar -->
            <aside class="main-sidebar ">
                <section class="infobar" data-spy="affix" data-offset-top="60" data-offset-bottom="200"> 
                    	
        <div><p><a href="https://github.com/cake-build/website/blob/develop/input/docs/build-systems/vso.md"><i class="fa fa-pencil-square" aria-hidden="true"></i> Edit Content</a></p></div>
    <div id="infobar-headings"><h6>On This Page</h6><p><a href="#install-the-vsts-extension">1. Install the VSTS extension</a></p>
<p><a href="#add-a-build-task">2. Add a build task</a></p>
<p><a href="#configure-the-build-task">3. Configure the build task</a></p>
<p><a href="#using-cake-with-a-powershellscript-in-vsts">Using Cake with a Powershellscript in VSTS</a></p>
<p><a href="#download-the-bootstrapperfile">1. Download the Bootstrapperfile</a></p>
<p><a href="#pin-nuget-to-at-least-v4.0.0">2. Pin NuGet to at least v4.0.0</a></p>
<p><a href="#run-your-build-build.cake">3. Run your build <code>build.cake</code></a></p>
<hr class="infobar-hidden">
</div>

                </section>
                <section class="sidebar">                    
                    

                    <ul class="sidebar-menu">
                        
                <li class="treeview">
                    <a href="/docs/overview">Overview</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                                        <li><a href="/docs/overview/features">Features</a></li>
                <li><a href="/docs/overview/requirements">Requirements</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/docs/tutorials">Tutorials</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                                        <li><a href="/docs/tutorials/getting-started">Getting Started</a></li>
                <li><a href="/docs/tutorials/setting-up-a-new-project">Setting Up A New Project</a></li>
                <li><a href="/docs/tutorials/powershell-security">Powershell Security</a></li>
                <li><a href="/docs/tutorials/extending-the-bootstrapper">Extending The Bootstrapper</a></li>
                <li><a href="/docs/tutorials/pinning-cake-version">Pinning Cake Version</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/docs/fundamentals">Fundamentals</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                                        <li><a href="/docs/fundamentals/tasks">Tasks</a></li>
                <li><a href="/docs/fundamentals/dependencies">Dependencies</a></li>
                <li><a href="/docs/fundamentals/criteria">Criteria</a></li>
                <li><a href="/docs/fundamentals/error-handling">Error Handling</a></li>
                <li><a href="/docs/fundamentals/finally-block">Finally Block</a></li>
                <li><a href="/docs/fundamentals/asynchronous-tasks">Asynchronous Tasks</a></li>
                <li><a href="/docs/fundamentals/setup-and-teardown">Setup And Teardown</a></li>
                <li><a href="/docs/fundamentals/running-targets">Running Targets</a></li>
                <li><a href="/docs/fundamentals/args-and-environment-vars">Arguments And Environment Variables</a></li>
                <li><a href="/docs/fundamentals/aliases">Script Aliases</a></li>
                <li><a href="/docs/fundamentals/preprocessor-directives">Preprocessor Directives</a></li>
                <li><a href="/docs/fundamentals/configuration">Configuration</a></li>
                <li><a href="/docs/fundamentals/default-configuration-values">Default Configuration Values</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/docs/tools">Tools</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                                        <li><a href="/docs/tools/installing-tools">Installing Tools</a></li>
                <li><a href="/docs/tools/tool-resolution">Tool Resolution</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/docs/cli">The Command Line</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                                        <li><a href="/docs/cli/usage">Usage Information</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/docs/editors">Editors</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                                        <li><a href="/docs/editors/atom">Atom</a></li>
                <li><a href="/docs/editors/vscode">Visual Studio Code</a></li>
                <li><a href="/docs/editors/visualstudio">Visual Studio</a></li>

                    </ul>
                </li>
                <li class="treeview active">
                    <a href="/docs/build-systems">Build Systems</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                                        <li class="selected"><a href="/docs/build-systems/vso">Visual Studio Team Services</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/docs/contributing">Contributing</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                                        <li><a href="/docs/contributing/contribution-guidelines">Contribution Guidelines</a></li>
                <li><a href="/docs/contributing/documentation">Documentation</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/docs/resources">Resources</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                                        <li><a href="/docs/resources/videos">Videos</a></li>
                <li><a href="/docs/resources/training">Training</a></li>
                <li><a href="/docs/resources/presentations">Presentations</a></li>
                <li><a href="/docs/resources/podcasts">Podcasts</a></li>
                <li><a href="/docs/resources/blogs">Blog Posts</a></li>
                <li><a href="/docs/resources/in-the-news">In The News</a></li>

                    </ul>
                </li>

                    </ul>
                </section>                
            </aside>
            
            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                



	<section class="content-header">
		<h1>Visual Studio Team Services</h1>
	</section>
	<section class="content">
		<p>The Cake VSTS build task makes it easy to run a Cake script directly, without having to invoke PowerShell or other command line scripts. This makes it easy even for team members that are not familiar with Cake to add or adjust parameters passed to your build scripts.</p>
<h1 id="install-the-vsts-extension">1. Install the VSTS extension</h1>
<p>To install the VSTS extension, go to the
<a href="https://marketplace.visualstudio.com/items/cake-build.cake">Cake Build Task page</a>
on the Visual Studio Marketplace and click "Install".</p>
<h1 id="add-a-build-task">2. Add a build task</h1>
<p>Go to the <code>Build</code> section in your VSTS tenant  and create a build definition, or
select an existing one. Add a new build step by clicking the
"Add build step..." button.</p>
<p><img src="https://raw.githubusercontent.com/cake-build/cake-vso/develop/Images/addbuildstep.png" class="img-fluid" alt="Add build step"></p>
<p>A dialog should appear with different tasks. Select the "Cake" task and click
the "Add" button once. After that, click the "Close" button to close the window.</p>
<p><img src="https://raw.githubusercontent.com/cake-build/cake-vso/develop/Images/addtasks.png" class="img-fluid" alt="Add build step"></p>
<h1 id="configure-the-build-task">3. Configure the build task</h1>
<p>You should now be able to edit the build task information such as which
build script to execute, what build target to run, the amount of logging
(verbosity) and additional arguments sent to the build script.</p>
<p>By default, the Cake build step (when added to a build) will try to run the <code>build.cake</code> build script (found in the root of your repository) with the target <code>Default</code>. If you wish to run another build script or build target you can change this in the build step settings.</p>
<p><img src="https://raw.githubusercontent.com/cake-build/cake-vso/develop/Images/configurebuildstep.png" class="img-fluid" alt="Add build step"></p>
<p>For those who are already using Cake making use of the <a href="https://cakebuild.net/docs/tutorials/setting-up-a-new-project">Bootstrapper file</a>, this is not called when using the VSO task.
To use the bootstrapper file you should add a "PowerShell" or "Shell Script" task instead.</p>
<h2 id="notes-about-variables">Notes about Variables</h2>
<p>Environment Variables which are marked secret in VSTS, cannot be resolved using <code>EnvironmentVariable()</code> in a Cake script. Instead they can be passed as arguments to the build script. You can read more about this limitation in the <a href="https://www.visualstudio.com/en-us/docs/build/define/variables#SecretVariables">Visual Studio documentation under the Secret Variables section</a>.</p>
<h1 id="using-cake-with-a-powershellscript-in-vsts">Using Cake with a Powershellscript in VSTS</h1>
<p>This manual shows how you can use the powershell bootstrapper to build a .Net Standard library (Visual Studio 2017) on a Hosted VS2017 agent.<br>
This guide also shows how you resolve the following error:</p>
<blockquote class="blockquote">
<p>[error] Failed to load msbuild Toolset<br>
Could not load file or assembly 'Microsoft.Build, Version=14.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a' or one of its dependencies. The system cannot find the file specified.
An error occurred when executing task 'RestorePackages'.<br>
Error: NuGet: Process returned an error (exit code 1).</p>
</blockquote>
<h1 id="download-the-bootstrapperfile">1. Download the Bootstrapperfile</h1>
<p>To download the file go to the <a href="https://cakebuild.net/docs/tutorials/setting-up-a-new-project">Setting up a new project</a> page and download the bootstrapper file for your platform.</p>
<h1 id="pin-nuget-to-at-least-v4.0.0">2. Pin NuGet to at least v4.0.0</h1>
<p>To pin the version you have to edit the build.ps1 file. This is necessary because the current Hosted VS2017 agent has several versions installed and without pinning it, the wrong version will be resolved.
Probably with the following Error:</p>
<h3 id="find-the-part-where-the-nuget-source-url-is-defined">2.1 Find the part where the nuget source url is defined</h3>
<p>This will look like this:</p>
<p><img src="/assets/img/vsts_bootstrapper_nugetsource_snippet.PNG" class="img-fluid" alt="NuGet source snippet"></p>
<h3 id="pin-the-nuget-version">2.2 Pin the NuGet version</h3>
<p>Change the URL <code>https://dist.nuget.org/win-x86-commandline/latest/nuget.exe</code> to <code>https://dist.nuget.org/win-x86-commandline/v4.0.0/nuget.exe</code> to pin NuGet to version 4.0.0.</p>
<h3 id="change-the-nuget-resolution">2.3 Change the NuGet resolution</h3>
<p>The NuGet resolution part has to be modified like the following (remove the red highlighted text parts):</p>
<pre><code class="language-diff">-# Try find NuGet.exe in path if not exists
-if (!(Test-Path $NUGET_EXE)) {
-    Write-Verbose -Message "Trying to find nuget.exe in PATH..."
-    $existingPaths = $Env:Path -Split ';' | Where-Object { (![string]::IsNullOrEmpty($_)) -and (Test-Path $_) }
-    $NUGET_EXE_IN_PATH = Get-ChildItem -Path $existingPaths -Filter "nuget.exe" | Select -First 1
-    if ($NUGET_EXE_IN_PATH -ne $null -and (Test-Path $NUGET_EXE_IN_PATH.FullName)) {
-        Write-Verbose -Message "Found in PATH at $($NUGET_EXE_IN_PATH.FullName)."
-        $NUGET_EXE = $NUGET_EXE_IN_PATH.FullName
-    }
-}
-
-# Try download NuGet.exe if not exists
-if (!(Test-Path $NUGET_EXE)) {
    Write-Verbose -Message "Downloading NuGet.exe..."
    try {
        (New-Object System.Net.WebClient).DownloadFile($NUGET_URL, $NUGET_EXE)
    } catch {
        Throw "Could not download NuGet.exe."
    }
-}
</code></pre>
<h1 id="run-your-build-build.cake">3. Run your build <code>build.cake</code></h1>
<p>Now you can run your <code>build.cake</code> script on a Hosted VS2017 agent.<br>
A simple <code>build.cake</code> script would be:</p>
<pre><code class="language-csharp">#addin "nuget:?package=NuGet.Core"
#addin "Cake.FileHelpers"
#addin "Cake.Incubator"
#addin "Cake.ExtendedNuGet"
#tool "nuget:?package=xunit.runner.console"
#tool "nuget:?package=vswhere"

var target        = Argument("target", "Default");
var configuration = Argument("configuration", "Release");
var buildNumber   = Argument("buildnumber", "0");
var buildDir      = Directory("./artifacts");
var solution      = "./&lt;YourSolutionFile&gt;.sln";


Task("Clean")
    .Does(() =&gt;
{
    CleanDirectory(buildDir);
});

Task("RestorePackages")
    .IsDependentOn("Clean")
    .Does(() =&gt;
{
    NuGetRestore(solution);
});

Task("Build")
    .IsDependentOn("RestorePackages")
    .Does(() =&gt;
{
    MSBuild(solution, settings =&gt; settings
        .SetConfiguration(configuration)
        .SetVerbosity(Verbosity.Minimal)
        .UseToolVersion(MSBuildToolVersion.VS2017)
    );
});

Task("RunTests")
    .IsDependentOn("Build")
    .Does(() =&gt;
{

	var projects = GetFiles("./src/**/*.Tests.csproj");

	foreach(var project in projects)
	{
		DotNetCoreTest(project.FullPath);
	}
});

Task("Default")
    .IsDependentOn("RunTests");

RunTarget(target);
</code></pre>

	</section>
                
            </div>           
            
            <!-- Footer -->
            <footer class="main-footer">
            </footer>
            
        </div>
        <div class="wrapper bottom-wrapper">
            <footer class="bottom-footer">
                <p class="text-muted">
    <a href="https://github.com/cake-build/cake"><i class="fa fa-github"></i> GitHub</a> |
    <a href="https://twitter.com/cakebuildnet"><i class="fa fa-twitter"></i> Twitter</a> |
    <a href="https://gitter.im/cake-build/cake"><i class="fa fa-comment"></i> Gitter</a>
    <br>
    Copyright © <a href="http://dotnetfoundation.org">.NET Foundation</a> and contributors.
    <br>
    Generated by <a href="http://wyam.io">Wyam</a>
</p>
            </footer>
        </div>
        <a href="javascript:" id="return-to-top"><i class="fa fa-chevron-up"></i></a>
        <!-- Gitter -->
<script>
    ((window.gitter = {}).chat = {}).options = {
        room: 'cake-build/cake'
    };
</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async="" defer=""></script>

<!-- Google Analytics -->
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
            m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-60516413-1', 'auto');
    ga('send', 'pageview');
</script>
        <script>           
            // Close the sidebar if we select an anchor link
            $(".main-sidebar a[href^='#']:not('.expand')").click(function(){
                $(document.body).removeClass('sidebar-open');
            });
            
            $(document).load(function() {
                mermaid.initialize(
                {
                    flowchart:
                    {
                        htmlLabels: false,
                        useMaxWidth:false
                    }
                });  
                mermaid.init(undefined, ".mermaid")
                $('svg').addClass('img-responsive');
                
                $('pre code').each(function(i, block) {
                    hljs.highlightBlock(block);
                });  
            });
            hljs.initHighlightingOnLoad();

            // Back to top
            $(window).scroll(function() {
                if ($(this).scrollTop() >= 200) {        // If page is scrolled more than 50px
                    $('#return-to-top').fadeIn(1000);    // Fade in the arrow
                } else {
                    $('#return-to-top').fadeOut(1000);   // Else fade out the arrow
                }
            });
            $('#return-to-top').click(function() {      // When arrow is clicked
                $('body,html').animate({
                    scrollTop : 0                       // Scroll to top of body
                }, 500);
            });
        </script>
    
</body></html>